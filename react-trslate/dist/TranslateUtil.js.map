{"version":3,"sources":["../src/TranslateUtil.jsx"],"names":["parserString","mdToString","translate","interpolation","Token","String","constructor","string","tag","toString","CompInter","text","split","TranslateText","Array","join","result","length","lastStr","inBra","i","char","push","test","replace","value","args","arg0","data","Object","shouldReact","resultArray","map","e","tmp","React","cloneElement","children","props","console","log","createElement","Fragment","t","childs","shouldSetPlace","some","place","find","defaultFormat","b","u","code"],"mappings":"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","file":"TranslateUtil.js","sourcesContent":["//@ts-check\r\nimport React from 'react';\r\nimport { isElement } from 'react-is';\r\n\r\n\r\nclass Token extends String {\r\n  constructor(string) {\r\n    super(string)\r\n    this.tag = string;\r\n  }\r\n  toString() {\r\n    return '{' + this.tag + '}'\r\n  }\r\n\r\n}\r\n\r\nclass CompInter extends String {\r\n  constructor(string) {\r\n    const [tag, text] = string.split('|')\r\n    super(text)\r\n    this.tag = tag;\r\n    this.text = text;\r\n  }\r\n  toString() {\r\n    return '{' + this.tag + '|' + this.text + '}'\r\n  }\r\n}\r\n\r\nclass TranslateText extends Array {\r\n  toString() {\r\n    return this.join('')\r\n  }\r\n}\r\n\r\nexport function parserString(text) {\r\n  const result = new TranslateText()\r\n  const length = text.length;\r\n  let lastStr = \"\", inBra = false;\r\n  for (var i = 0; i < length; i++) {\r\n    var char = text[i];\r\n    if (char == '{') {\r\n      if (inBra) {\r\n        lastStr = '{' + lastStr;\r\n      }\r\n\r\n      lastStr && result.push(lastStr)\r\n      lastStr = '';\r\n      inBra = true;\r\n    } else if (char == '}' && inBra) {\r\n      if (/^(\\d+|[a-z]+)\\|/.test(lastStr))\r\n        result.push(new CompInter(lastStr))\r\n      else\r\n        result.push(new Token(lastStr))\r\n      lastStr = '';\r\n      inBra = false;\r\n    } else {\r\n      lastStr += char;\r\n    }\r\n  }\r\n  lastStr && result.push(lastStr)\r\n  return result;\r\n}\r\n\r\n\r\nexport function mdToString(text = '') {\r\n  return text\r\n    .replace(/\\*\\*([^\\*]+)\\*\\*/g, \"{b|$1}\")\r\n    .replace(/__([^_]+)__/g, \"{u|$1}\")\r\n    .replace(/`([^`]+)`/g, \"{code|$1}\")\r\n    .replace(/_([^_]+)_/g, \"{i|$1}\")\r\n}\r\n\r\n\r\n\r\nexport function translate(value, ...args) {\r\n  var arg0 = args[0]\r\n  var data = (args.length == 1 && arg0 instanceof Object && !isElement(arg0))\r\n    ? arg0 : args\r\n  var shouldReact = false;\r\n  var resultArray = value.map(e => {\r\n    if (e instanceof Token || e instanceof CompInter) {\r\n      var tmp = data[e.tag]\r\n      if (isElement(tmp)) {\r\n        shouldReact = true;\r\n        if (e instanceof CompInter)\r\n          tmp = React.cloneElement(\r\n            tmp,\r\n            { children: tmp.props.children || e.text }\r\n          )\r\n      }\r\n      return tmp || e\r\n    } else {\r\n      return e;\r\n    }\r\n  })\r\n  console.log(resultArray);\r\n  return shouldReact\r\n    ? React.createElement(React.Fragment, {}, ...resultArray)\r\n    : resultArray.join('')\r\n}\r\n\r\n\r\nexport function interpolation({ t: value, children, ...args }) {\r\n  var childs = children instanceof Array ? children : (children ? [children] : [])\r\n  var shouldReact = false\r\n  var shouldSetPlace = childs.some(e => e.props && e.props.place);\r\n  var resultArray = value.map(e => {\r\n    if (e instanceof Token || e instanceof CompInter) {\r\n      var tag = e.tag\r\n      var tmp = shouldSetPlace\r\n        ? childs.find(e => isElement(e) && e.props.place == tag)\r\n        : (args[tag] || childs[tag])\r\n\r\n      if (isElement(tmp)) {\r\n        shouldReact = true;\r\n        if (e instanceof CompInter)\r\n          tmp = React.cloneElement(\r\n            tmp,\r\n            { children: tmp.props.children || e.text }\r\n          )\r\n      }\r\n      return tmp || e\r\n    } else {\r\n      return e;\r\n    }\r\n  })\r\n  console.log(resultArray);\r\n  return shouldReact\r\n    ? React.createElement(React.Fragment, {}, ...resultArray)\r\n    : resultArray.join('')\r\n}\r\n\r\n\r\nexport const defaultFormat = { b: <b />, i: <i />, u: <u />, code: <code /> }\r\n"]}